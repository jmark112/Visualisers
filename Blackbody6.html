<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Black Body Radiation Visualizer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    #graph-container {
      width: 100%;
      max-width: 800px;
      margin: auto;
      position: relative;
    }
    #controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
    #blackbody {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 4px solid #333;
      margin: 30px auto;
      background-color: #2b2b2b;
      box-shadow: 0 0 20px #2b2b2b;
    }
    #spectrumBackground {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to right,
        black 0%,
        black 17%,
        violet 17%,
        indigo 20%,
        blue 23%,
        green 26%,
        yellow 29%,
        orange 32%,
        red 35%,
        black 35%,
        black 100%
      );
      opacity: 0.25;
      z-index: 0;
    }
    canvas {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Black Body Radiation Visualizer</h2>
  <div id="graph-container">
    <div id="spectrumBackground"></div>
    <canvas id="spectrumChart"></canvas>
  </div>

  <div id="blackbody"></div>

  <div id="controls">
    <button id="decreaseBtn">-</button>
    <input type="range" id="tempSlider" min="100" max="7000" value="3000" step="10" onchange="updateVisualizer()" />
    <button id="increaseBtn">+</button>
    <span id="tempDisplay">3000 K</span>
  </div>

  <script>
    const PLANCK = 6.62607015e-34;
    const C = 2.99792458e8;
    const K = 1.380649e-23;

    let temperature = 3000;
    const wavelengths = Array.from({ length: 500 }, (_, i) => 100e-9 + i * 3.8e-9);

    // Calculate max intensity at 7000 K to scale y-axis
    const maxY = Math.max(...wavelengths.map(wl => planck(wl, 7000)));

    function planck(wl, T) {
      return (
        (2 * PLANCK * C ** 2) /
        (wl ** 5) /
        (Math.exp((PLANCK * C) / (wl * K * T)) - 1)
      );
    }

    function peakWavelength(T) {
      return (2.897771955e-3 / T) * 1e9;
    }

    const ctx = document.getElementById("spectrumChart").getContext("2d");
    let chart;

    function updateChart() {
      const intensities = wavelengths.map((wl) => planck(wl, temperature));
      const labels = wavelengths.map((wl) => Math.round(wl * 1e9));

      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [
            {
              data: intensities,
              borderColor: "black",
              pointRadius: 0,
              borderWidth: 2,
              fill: {
                target: "origin",
                above: "rgba(0,0,0,0.1)", // fallback fill if outside visible range
              },
            },
          ],
        },
        options: {
          scales: {
            x: {
              title: { display: true, text: "Wavelength (nm)" },
              min: 100,
              max: 2000,
            },
            y: {
              title: { display: true, text: "Intensity" },
              min: 0,
              max: maxY,
              ticks: { display: false },
            },
          },
          plugins: { legend: { display: false } },
          elements: { line: { tension: 0 } },
        },
      });
    }

    function updateGlow() {
      const peak = peakWavelength(temperature);
      let color;
      if (temperature < 800) color = "#2b2b2b";
      else if (temperature < 1200) color = "#7f1d1d";
      else if (temperature < 2000) color = "#b45309";
      else if (temperature < 3000) color = "#eab308";
      else if (temperature < 4500) color = "#fef08a";
      else if (temperature < 6000) color = "#f8fafc";
      else color = "#bae6fd";
      const bb = document.getElementById("blackbody");
      bb.style.backgroundColor = color;
      bb.style.boxShadow = `0 0 60px ${color}`;
    }

    function updateVisualizer() {
      temperature = parseInt(document.getElementById("tempSlider").value);
      document.getElementById("tempDisplay").innerText = `${temperature} K`;
      updateChart();
      updateGlow();
    }

    let holdInterval;

    function startHoldAdjust(delta) {
      adjustTemp(delta);
      holdInterval = setInterval(() => adjustTemp(delta), 50);
    }

    function stopHoldAdjust() {
      clearInterval(holdInterval);
    }

    function adjustTemp(delta) {
      let slider = document.getElementById("tempSlider");
      slider.value = Math.min(7000, Math.max(100, parseInt(slider.value) + delta));
      updateVisualizer();
    }

    document.getElementById("increaseBtn").addEventListener("mousedown", () => startHoldAdjust(10));
    document.getElementById("increaseBtn").addEventListener("mouseup", stopHoldAdjust);
    document.getElementById("increaseBtn").addEventListener("mouseleave", stopHoldAdjust);

    document.getElementById("decreaseBtn").addEventListener("mousedown", () => startHoldAdjust(-10));
    document.getElementById("decreaseBtn").addEventListener("mouseup", stopHoldAdjust);
    document.getElementById("decreaseBtn").addEventListener("mouseleave", stopHoldAdjust);

    updateVisualizer();
  </script>
</body>
</html>
